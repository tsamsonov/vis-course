---
title: "Картограммы"
subtitle: "Визуализация пространственных данных"
date: today
date-format: long
author: "Самсонов Тимофей Евгеньевич"
execute:
  echo: false
  freeze: true
jupyter: python3
format:
  revealjs: 
    theme: [default, custom.scss]
    margin: 0.2
    width: 1280
    height: 720
    slide-number: true
    footer: "Самсонов Т. Е. Визуализация пространственных данных: курс лекций"
    header-includes: <link rel="stylesheet" media="screen" href="https://fontlibrary.org//face/pt-sans" type="text/css"/>
bibliography: references.yaml
mainfont: PT Sans
---

## Картограммы

При использовании картограмм для визуализации пространственных данных необходимо учитывать следующие аспекты:

1.  Стандартизация данных
2.  Различия в цветовых шкалах и критерии их выбора
3.  Использование методов классификации или непрерывных шкал
4.  Оформление легенды
5.  Оценка визуальной сложности
6.  Технические возможности программных библиотек

## Стандартизация

Поскольку единицы картографирования имеют разный размер, необходимо выполнять **стандартизацию** данных — нормировку сумм и площадей.

При стандартизации используются отношения:

1.  Площадь на площадь

2.  Сумма на площадь

3.  Сумма на сумму

::: callout-note
## Сумма и площадь

Под суммой в данном случае понимается показатель, не являющийся площадью. Например, объем заготавливаемой древесины. Ему можно противопоставить площадь лесов.
:::

::: callout-tip
## Стандартизация без площадей

При делении суммы на сумму косвенным образом учитывается и неравенство площадей, т.к. более крупные площади часто имеют и более крупные суммы показателей.
:::

## Стандартизация

**Пример**: доля возделываемых площадей, с которых собирается урожай (А) и урожайность с единицы площади (В)

![От типа стандартизации зависит пространственное распределение показателя](images/clipboard-3281427333.png){fig-align="left"}

## Цветовые шкалы

**Последовательные** шкалы используются для отображения *униполярных* показателей (не имеющих нейтральное значение).

::: columns
::: {.column width="50%"}
**Одноцветные**

```{python}
import matplotlib.pyplot as plt
import mapclassify as mc
import seaborn as sns
import numpy as np

sns.palplot(sns.color_palette("Greys", 7))
sns.palplot(sns.color_palette("Greens", 7))
sns.palplot(sns.color_palette("Purples", 7))
```
:::

::: {.column width="50%"}
**Многоцветные**

```{python}
sns.palplot(sns.color_palette("PuBuGn", 7))
sns.palplot(sns.color_palette("YlGnBu", 7)) 
sns.palplot(sns.color_palette("RdPu", 7))
```
:::
:::

В последовательных шкалах понижается светлота и увеличивается насыщенность.

## Цветовые шкалы

**Расходящиеся** шкалы используются для отображения *биполярных* показателей (имеющих нейтральное значение, обычно $0$).

::: columns
::: {.column width="50%"}
**Двухцветные**

```{python}
sns.palplot(sns.color_palette("RdBu", 7))
sns.palplot(sns.color_palette("BrBG", 7))
sns.palplot(sns.color_palette("PRGn", 7))
```
:::

::: {.column width="50%"}
**Трехцветные**

```{python}
sns.palplot(sns.color_palette("RdYlBu", 7))
sns.palplot(sns.color_palette("RdYlGn", 7)) 
sns.palplot(sns.color_palette("Spectral", 7))
```
:::
:::

Расходящиеся шкалы получаются путем объединения двух последовательных шкал

## Цветовые шкалы

**Категориальные** шкалы используются для отображения *номинальных* (качественных) показателей.

::: columns
::: {.column width="50%"}
**Насыщенные**

```{python}
sns.palplot(sns.color_palette("Dark2", 7))
sns.palplot(sns.color_palette("Set1", 7))
```
:::

::: {.column width="50%"}
**Пастельные**

```{python}
sns.palplot(sns.color_palette("Pastel1", 7))
sns.palplot(sns.color_palette("Pastel2", 7)) 
```
:::
:::

Для категориальных шкал важна одинаковая светлота и насыщенность элементов.

::: callout-warning
## Номинальные данные

Номинальные данные нельзя картографировать с помощью последовательных и расходящихся шкал
:::

## Color Brewer

Для выбора шкал удобно использовать сайт **Color Brewer**. Его шкалы есть в `matplotlib` и `seaborn`.

![](images/clipboard-4208284786.png)

## Классификация или нет?

Неклассифицированные картограммы точнее отображают данные, однако могут быть трудны для восприятия в зависимости от распределения показателя.

![](images/clipboard-2225744427.png)

## Классификация или нет?

Неклассифицированные картограммы точнее отображают данные, однако могут быть трудны для восприятия в зависимости от распределения показателя.

![](images/clipboard-3658542196.png)

## Легенда

::: columns
::: {.column width="50%"}
В *американской* картографической школе принято плашки для легенды картограмм показывать **слитно**, т.к. это указывает на соседство учетных единиц

![](images/clipboard-129992976.png)

Допускается указание границ вместо интервалов
:::

::: {.column width="50%"}
В *русской* школе плашки для легенды картограмм принято показывать **раздельно**, т.к. учетные единицы могут не быть в соседних классах

![](images/clipboard-3237029520.png)
:::
:::

## Легенда

::: columns
::: {.column width="40%"}
Элементы упорядочиваются последовательно, при этом предпочтительным вариантом является увеличение слева направо (**A**) и снизу вверх (**C**).

Другие варианты допустимы, но менее ассоциативны (читаем слева направо, выше — больше).

::: callout-tip
## Количество классов

Читатель карты нормально различает 5, в некоторых случаях до 7 классов. Больше делать не рекомендуется.
:::
:::

::: {.column width="60%"}
![](images/clipboard-2755071279.png)
:::
:::

## Визуальная сложность

**Сложность**: визуальная загруженность, мозаичность изображения

$$C = \frac{N_{c}}{N},$$

где $N$ — общее число полигонов/границ/вершин в полном наборе единиц, $N_c$ — число тех же элементов после объединения единиц, попадающих в один класс.

::: callout-tip
## Интерпретация

Сложность картограмм показывает на какое количество однородных областей делится изображение при выбранном методе классификации и количестве классов.
:::

::: callout-note
## Применение

Наилучшие картограммы получаются при оптимальном сочетании добротности классификации (GADF) и визуальной сложности (C).
:::

## Визуальная сложность

В зависимости от выбранного метода классификации и количества классов будет меняться характер распределения и его визуальная сложность.

![Фишер-Дженкс (k = 8, C = 0.47)](images/clipboard-3894783524.png){fig-align="left"}

## Визуальная сложность

В зависимости от выбранного метода классификации и количества классов будет меняться характер распределения и его визуальная сложность.

![Квантили (k = 4, C = 0.31)](images/clipboard-4107761414.png){fig-align="left"}

## Библиография
